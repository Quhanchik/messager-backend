package kz.fakewhatsapp.fakewhatsapp.controller;

import kz.fakewhatsapp.fakewhatsapp.dto.ChatDTO;
import kz.fakewhatsapp.fakewhatsapp.dto.NewChatReq;
import kz.fakewhatsapp.fakewhatsapp.models.Chat;
import kz.fakewhatsapp.fakewhatsapp.models.User;
import kz.fakewhatsapp.fakewhatsapp.services.ChatService;
import kz.fakewhatsapp.fakewhatsapp.services.UserService;
import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.messaging.handler.annotation.MessageMapping;
import org.springframework.messaging.handler.annotation.Payload;
import org.springframework.messaging.simp.SimpMessagingTemplate;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/chat")
@CrossOrigin
public class ChatController {
    private final ChatService chatService;
    private final ModelMapper modelMapper;
    private SimpMessagingTemplate messagingTemplate;
    private UserService userService;

    @Autowired
    public ChatController(ChatService chatService, ModelMapper modelMapper, SimpMessagingTemplate messagingTemplate, UserService userService) {
        this.chatService = chatService;
        this.modelMapper = modelMapper;
        this.messagingTemplate = messagingTemplate;
        this.userService = userService;
    }

    @PostMapping()
    public void saveChat(ChatDTO chatDTO) {
        chatService.save(convertChatDTOToChat(chatDTO));
    }

    @GetMapping("/{id}")
    public ChatDTO getChat(@PathVariable("id") Long id) {
        return convertChatToChatDTO(chatService.getChatById(id));
    }

    @MessageMapping("/chat")
    public void processChat(@Payload NewChatReq newChatReq) {
        System.out.println(newChatReq);
        Chat chat = new Chat(newChatReq.getTitle(), newChatReq.getMembers());
        chat.getMembers().add(userService.findUserById(newChatReq.getSenderId()));
        if(newChatReq.getAvatar() == null) {
            chat.setAvatar("data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD//gA7Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2NjIpLCBxdWFsaXR5ID0gNzUK/9sAQwAIBgYHBgUIBwcHCQkICgwUDQwLCwwZEhMPFB0aHx4dGhwcICQuJyAiLCMcHCg3KSwwMTQ0NB8nOT04MjwuMzQy/9sAQwEJCQkMCwwYDQ0YMiEcITIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy/8AAEQgC7gLuAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A9hooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAopcVBd3drp1q11fXMNrbL1lmfapP8AWgCagAscAEn0Feda18YdJtGeLRbKXUZBwJpP3cX+J/SuF1T4leK9ULAagLKE9IrNAmP+BdaAPoCTbCpeZ0iQdWkcKB+dZNz4n8O2hIn17TlI6qswYj8q+bLiee8fzLq5nuH/AL00pY1EEReiKPwoA+in8f8AhGNtra7AT14Rj/SnxeO/Cc2NmvWoycfOGX+Yr50x7UhAPUD8qAPp621vRr3AtdZ0+Yn+FJ1LflWh5bkZC5A645FfJ/lx5+4AfUDBq/YatqeltnT9Su7bBziOYgE/TpQB9P0V4jpXxd8RWWF1CK11OIdS6+XIB/vLx+ld/oXxN8N62ywyztpl23HlXYwhPs/T88UAdfRSkYAPBBGQQcg0lABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFLigBKADyeAAMlicAD1NVr+/s9KsJr/ULmO3tIRl5HP6D1J9Oprw3xl8Qb/xS72lt5llowJ2wg4ef3kP/ALL0FAHa+KfixZ6e72fh5Y766XIe7k/1EZ/2f75/SvJtU1XUNcvDd6rey3cxzgyH5VH+yvQVTAAAAGAOg7CigAFFFFABRRRQAUUUUAFFFFABSEBlIIBB7EZFLRQBv+HPGuu+F2CWVyZ7IH5rO5O6M/7vdfwr2fwt460jxYFihY2mogZexmYbj7of4h/nFfPNAJR0dGZHQhkdThlb1BoA+qz78UV5d4I+KHnvHpXiaYCQ4WHUW4Deiy+h/wBr869SYFWIIwRQAlFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABVa/1C00rT59Q1CcQWsClpHP6AepPYdzVkDPVgAASWPAA9TXgfxB8Zt4q1T7NaORo1o5EK9p3HWQ/09BQBR8YeMLzxhqImmUwafASbW0zwg/vN6uf06CuepaSgAooooAKKKKACiiigAooooAKKKKACiiigAooooAQgMpBAIPBB5Br034c/EBrOSLQdduCbVyEsruU58k/883P909j2rzOkIDKQRkHgigD6tZSjFSMEcYpK84+F3jNtTtx4d1KXff26Zs5WPM8Y/gP+0v6j6V6PQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRUN3eQabY3GoXTbbe1iaaU+qigDz/4seKG0/TU8PWchS6vU33LA8xw/wB36t/KvGgAAABgDgCreq6nPrer3mqXRzNdSmQjOQF/hX8BiqlABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAD7e4ns7qG7tJDFcwOJIpB1VhX0l4Z8Qw+KfD1tqsICSPlLiIHPlyj7w/qPY181V3Pwq8QHSPFH9mTviy1PEeCeFmH3T+PT8qAPcqKCCCQeCOCKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigArzn4xax9k0Cz0WNsSX8nmygH/lkn+Lfyr0YAsQB1JwK+f/AIk6mdU8e3+1sw2gW1iHoFHzf+PE0AcpRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQACgl1IeJisiEMrA4IYciiloA+mPD+rrr/h3TtVUAG4iBkUdFccMPzFaVeZ/BnUzLpGqaS7c28wniB/uvwR+Y/WvTKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAMq26vM/CRI0jH6A18rzXD3dzNdScyTyNIx9ySa+kfFdz9j8Ha1ODgizkVT6EjFfNKDEaj0UCgB1FFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB23wnvfsvj2KAnAvbaSHHbI+Yfyr3Wvm/wAHXJtPG2iTA4Ju0j/76ytfSLja7D0JFACUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAc38QWK/D3WipwTGo/NhXzwOgr6J8fReb8P8AWl7iANxz0YGvnYHKg+ooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigC5ox2+ItJIOCL2EgjqPmFfUUv+tb6mvl/QkMnibR4wQGe+iAJ6feFfT8n+tf6n+dADaKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAM/X7Y3vhnV7QDLS2ciqPfBxXzFGSYlPfaBX1hHgyAEZB+Ug9DmvlzVbA6XrV/p7Ag2tw8YB7jJxQBUooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAOh8BWpvfH2ixAZxOZf++VLV9Fk5Yn1JNeJ/B2xNx4tu71lylnaHB9Hc4H6Zr2ugAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAM4rw74t6UbHxkt+q4h1GESZ7B1wrf0r3GuN+J+hHWfBstxEu6600m5jx1Kfxj8ufwoA8GooBBAI6EZBooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKmsbCfV9StdNtV3XF1IIUHpnqfwGaAPaPhFpRsvCEuoSLiTUZy4J4Plr8q/rmu9qG0s4dOsbawtlAgtYlhjA7hR1qagAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKUbeQyB0IIZSMgg9RSUUAfOXjLw4/hfxPcWAU/ZJMzWj9jGe34dKwa+hPHfhUeK/D5igAGp2hMtm3Tcf4o/+Bfzr57wysQylGUlWQjDKw6g0AFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUYoAK9S+D/AIcZprjxPcJhVzb2YPc/xv8A0/OuA8PaBdeJ9et9JtMr5nzTS4yIox95j/T1NfSNlZW2nWFvY2cfl2tugjiX2H9T396AJ6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAUEjocH1ryr4oeCGkaXxNpUOWxnUIEXkj/nqo/8AQvzr1SgEg5HXoQeQRQB8qAhgCDkHnI6EUV6T8Qfhy2nNNregW7NYnL3VnGMmA93Qf3fUdvpXmoIdQQQQRkEd6AFooooAKKKKACiiigAooooAKKKKACiiigAooooAKfBBPd3UNrawvPcz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uniDw/YarHgfaogzgdBIOGH5g0AaFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABSqpdlUdSQBSVQ1vUxo2gajqZIBtbd3XPQvjC/rQB4R8QdY/tvxzqEyvm3tiLWH02p1/XNc1TV3FQWJLNyxPJJNOoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvW/gzqxe11PQ5GyYWF3Ap/unhh+eK8kro/AOq/2R450udmxDM5tpe2Q/A/XFAH0RRSsCrFT1BxSUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFcF8XtQ+y+DYrFTh766VWHrGnzH9cV3teOfGe98zxDpdgDkW1qZsejOf8A61AHnFJRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFIXaMCRGIeMhgR1BGDS0UAfUdherqWlWWoKQVurdJuOxIFWK4/4XX3234f2SFsvayyW7H6EkD8iK7CgAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAALEAdTwK+fPiPdi9+IWrODlYmSFRnONqjP65r6Gi/wBap9CDXy9rFyb3XtTuyc+fdSOD9WNAFKiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAPXPgtdltO1uxzxHNHMq/wC8CD/KvT68X+DdyY/Fd/bE4E9kWA9WVh/TNe0UAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAR3E4trO4nPSKF3/ACBr5Wi5jB9cn+dfTPiWbyPCOtSbsFbGXBHOCRxXzNFkQp67RmgB1FFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAdb8MJ/I+ImmAnCyrLGT/AMAJr36vnHwVKYPHWiSDvchODjqCK+j2GGYehNACUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQBz3jyXyfAOtPzzAF468sBXzoBhQPQAV9CfEl2j+HGssuCSsY59C618+UAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAX9Cfy/E2jyYzsvoTj1+YV9Py/wCuf6n+dfLWnEpq1iwOCLmMqR1B3CvqWX/Wt9aAGUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQBynxL/5JtrP/AGx/9GLXz+epr6C+JKNJ8ONZC9QIzz7SLXz9QAlFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUASWrmK/tJAMlZ0OPX5hX1VL/rD74NfLOnoZNWsI1UOWuY12nocsK+ppf9a3scUAMooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigDK8UWhvvCGs2yjLPaOVHqw5FfM8Z3RqfVRmvq5ArNtYfKwKkHoQa+X9X019G1zUNMcENa3DxgnuueD+IxQBTooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiigUAbfg6zN/430S3Az/pSyY9lyx/lX0i53Ox9STXivwe0w3Pim61IrmOxtyoPo78D9M17TQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAV478YtEa31i016NMQ3qCCdgOBKvTP1X+VexVn69o1t4i0K60m6OEnX5JCMmOQfdb8D+lAHzJRVi+sLrStRuNPvk8u6tnMci9s+o9j61XoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACkLBFLHgAZJpa6v4feFj4n8RqZ0P9mWJWa5bHDt/DH+J/SgD1P4baC2heDYDMmLvUD9qmz1AP3R+WPoTXW0pYsxJ79h0FJQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAcX8QfA48U2YvtPRRrVsmFycC5QfwMfX0P4GvCXR45WimjeKWMlXjcYZG9CK+qq5Pxj4CsPFim6jdbLV1GEuguVl9pB3Hv1FAHgFFaOt6Bqvhu8Nrq1m1u5JKSD5opB6q3T+orOoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigBaSkZgqklgB6nius8KfD/WPFDJOyNYaWeTdzL8zj/pmvU/yoAxtA0DUPE2rJpumoDIcNLK33IE/vN/Qd6+iNC0Ky8N6NDpenqfKj5eRvvSuert/ngcUaHoWm+GtMXT9Lg8uLO6R25eZ/7znv8AyHatGgAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigCO5t4L21e1vLeK5tnGGimXcprz/Wfg/o94xk0e7l0yU8+U48yI/wBR+teiUuaAPBNR+F3i2w3GOzhv4x/Hay5P/fJwa5q60jVrJiLvSr6DHBMkJAr6fyc5BwfWneY/QuSPQnNAHyjvXvkfVSKQyL6/pX1a6pJjzI4nx0zGDimeRB/z7w/9+hQB8q+Yvr+lHmL6/pX1V5EH/PvD/wB+hR5EH/PvD/36FAHyr5i+v6UeYvr+lfVXkQf8+8P/AH6FHkQf8+8P/foUAfKvmL6/pR5i+v6V9VeRB/z7w/8AfoUeRB/z7w/9+hQB8q+Yvr+lHmL6/pX1V5EH/PvD/wB+hR5EH/PvD/36FAHyr5i+v6UeYvr+lfVXkQf8+8P/AH6FHkQf8+8P/foUAfKvmL6/pR5i+v6V9VeRB/z7w/8AfoUeRB/z7w/9+hQB8q+Yvr+lHmL6/pX1V5EH/PvD/wB+hR5EH/PvD/36FAHyr5i+v6UeYvr+lfVXkQf8+8P/AH6FHkQf8+8P/foUAfKvmL6/pR5i+v6V9VeRB/z7w/8AfoUeRB/z7w/9+hQB8q+Yvr+lHmL6/pX1V5EH/PvD/wB+hR5EH/PvD/36FAHyr5i+v6UeYvr+lfVXkQf8+8P/AH6FHkQf8+8P/foUAfKvmL6/pR5i+v6V9VeRB/z7w/8AfoUeRB/z7w/9+hQB8q+Yvr+lHmL6/pX1V5EH/PvD/wB+hR5EH/PvD/36FAHyr5i+v6U5A0rbY0kdj0CISa+qPIg/594f+/QqRW2AKiooHQBAAKAPmiz8MeIdRIFpol9IDwHMJVfzOK6rTPhB4hu3U6lcWmmRn7ylvOlH4Dj9a9uMjsMF2I9M8UlAHI6D8NvDmhOk5gbUbxcETXg3Bf8AdToP1IrrizMck5I4HsKSigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/2Q==");
        }
        ChatDTO newChat = convertChatToChatDTO(chatService.save(chat));

        messagingTemplate.convertAndSend("/" + newChatReq.getSenderId() + "/chat", newChat);
    }

    private ChatDTO convertChatToChatDTO(Chat chat) {
        return modelMapper.map(chat, ChatDTO.class);
    }
    private Chat convertChatDTOToChat(ChatDTO chatDTO) {
        return modelMapper.map(chatDTO, Chat.class);
    }
}
